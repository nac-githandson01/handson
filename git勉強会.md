# 7/18 GitFlow 勉強会

## 目標

- git について基本的に理解している
- git の基本的な操作がコマンドラインベースでできる
- GitHubFlow でチームでの開発ができる

## 対象

- git を今まで触ったことのない人
- GitHubFlow(GitFlow)での開発経験のない人
- Git を CLI で操作したことのない人

## Git is なに？

- git は分散型バージョン管理システムです
- Subversion との違いは分散型か集中型かです。
- 集中型はリモートにのみリポジトリがあり、分散型はローカル、リモートリポジトリがあります。
- SVN と Git どちらがいいかはわかりません。ただし OSS での標準は Git になりつつあります。

## GitHub is なに？

- GitHub は一番メジャーな Git ホスティングサービスです
- Git ホスティングサービスにはほかに GitLab、BitBucket などがあります。

## GitHubFlowを使うと何がうれしいの？

- 開発(コーディング)におけるコミュニケーションが集約されます。またそのためのツールが用意されています。
- pullRequestというシステムのため、コードレビューが必須の運用になり品質の向上が見込めます。
- その他連携するツールによりCI（継続的インテグレーション）等が可能になり、コーディング〜テスト〜デプロイまでが流れ作業的に行うことができます。（今回は取り扱いません）

## GitHubFlow is なに？

- GitHubFlow は Git-Flow から派生した開発ワークフローです。
- 原則は下記です

    1. master ブランチを常にデプロイできる状態にしておく

    1. 新しい作業をするときは master ブランチを作成し、そのブランチで作業する

    1. 作成したローカルリポジトリのブランチにコミットする

    1. 同名のブランチを Github のリポジトリに作成し、定期的にプッシュする

    1. 助けてほしい時やフィードバックがほしいときはプルリクエストを作成し、プルリクエストでやりとりする

    1. 他の開発者がレビューし、作業終了を確認したら master ブランチにマージする

    1. master ブランチへマージしたら、直ちにデプロイする

- ![図解](https://raw.githubusercontent.com/tbpgr/github_flow_for_ja/master/github_flow_gviz.png)

## GitHubFlow を使うと何がうれしいの？

- 開発(コーディング)におけるコミュニケーションが集約されます。またそのためのツールが用意されています。
- pullRequest というシステムのため、コードレビューが必須の運用になり品質の向上が見込めます。
- その他連携するツールにより CI（継続的インテグレーション）等が可能になり、コーディング〜テスト〜デプロイまでが流れ作業的に行うことができます。（今回は取り扱いません）

## ハンズオンの前に

- 今さらですがGitやSubversionを触ったことのない人にとっては、初めての単語が大量にでてくると思いますので簡単に説明します。

    1. リポジトリ(ripository)
        ファイルの保管場所です。
    1. クローン(clone)
        他のリポジトリからファイルをもってくることです。
    1. ブランチ(branch)
        分岐のことです。
    1. コミット(commit)
        変更を確定することです。
    1. プッシュ(push)
        コミットした変更を別のリポジトリに反映させることです。
    1. プルリクエスト(pull request)
        ブランチ間の差分を反映する要求をすることです。
    1. マージ(merge)
        ブランチ間の差分を反映させることです。
    1. フェッチ(fetch)
        ローカルリポジトリを更新することです。
    1. コンフリクト(conflict)
        マージの際変更の差分が競合することです。

## ハンズオン

- 準備

    通常WindowsにはGitを利用できる環境がありませんのでAWSCloud9条でハンズオンを行います。以下確認してください。

    1. GoogleChromeのインストール
    1. AWSアカウントの発行及びCloud9UsersIAMrollの発行

- 以下の手順で進めます。
    1. リモートリポジトリの作成
    1. リポジトリのクローン
    1. ブランチの作成
    1. 変更のコミット
    1. リモートへのプッシュ
    1. プルリクエスト
    1. マージ

- 管理者がリモートリポジトリを作成し、開発者が機能を追加するところというケースになります。
- そのため開発者側が行う操作を重点的にやります

1. リモートリポジトリの作成

    - 管理者側が行う操作です。
    - GitHub から CreateNewRipository を行います
    - ここのタイミングで「master」ブランチが作成されます

1. リポジトリのクローン

    - 作成されたリポジトリからローカルに持ってきます。
    - 「CloneOrDownload」から「Clone with HTTPS」の URL をコピーします
    - ターミナルから Clone コマンドを叩きます

    ``` bash
    $ git clone [URL]
    ```

    - SSH プロトコルによっても可能です（今回は扱いません）
    - ここのタイミングで GitConfig を編集します（Cloud ９特有の問題のため）

    ``` bash
    $ cd [dirname]
    $ git config --local user.name "[NAME]"
    $ git config --local user.email "[EMAILADDRESS]"
    $ git config --local --list
    ```

1. master ブランチから新規ブランチを切る

    - master ブランチから開発用ブランチを切ります
    - ブランチの名前は「追加する機能名」とかでつけます。ただしこれも現場によります。（私のとこは future-チケットナンバー。ITS ドリブンなので）

    ``` bash
    $ git branch -a
    $ git checkout -b [branchName]
    $ git branch -a
    ```

1. 変更のコミット

    - ここでファイルを追加したり変更したりします。
    - 変更の区切りでコミットをします
    - 基本的にコミットコメントは必須です。
    - またコメントが変更をしっかりと表したコメントをつけましょう
    - 「git commit -m "hogehoge" -m "fugafuga"」といったように複数行のコメントもできます
    - git 管理にしたくないファイル(アカウント情報等)の除外リスト(.gitignore)というファイルを作ることもできます。(今回は飛ばします)

    ``` bash
    $ git add [fileName / 変更のあったすべてのファイルの場合「.」]
    $ git diff [master/比較したいBranchName]
    $ git commit -m "[コメント]"
    ```

    - これらを繰り返します。

1. リモートへのプッシュ

    - ローカルでの開発が終わったらリモートリポジトリに push します。
    - これは定期的に行ってください。
    - リモートに push することで他の開発者が進行状況を知ることができます

    ``` bash
    $ git push origin [branchName]
    ```

1. プルリクエスト

    - ここからは GitHub での操作になります。
    - もう master に乗っけてもいいかな？もしくはここは相談したいなってタイミングで PullRequest します
    - タイトルにプルリクエストの目的を書き、コメントに変更内容と理由等を書きます（ここも現場ルールがあると思います）
    - もし作業中に相談したい場合はタイトルの頭に「[WIP]」つけてコメントに相談したい箇所と内容を書きましょう

1. コードレビュー

    - プルリクエストを投げたらレビュアーとコードレビューを行います。
    - 相談ごともここの disscuss でやります
    - 「@username」でメンションもできます。
    - レビューはその言語らしく書けてるか、仕様に問題はないか等、観点を決めて行うとレビュアーもレビュイーも幸せになります。観点によってはレビュアーを変えたりします
    - レビュアーは悪いコードを憎むべきですが、コーダーを憎んではいけません。
    - 参考になるコードレビューでのコミュニケーション、レビュアーもレビュイーも必読だと思います[コードレビューで気をつける言葉や行い](http://macotox.hateblo.jp/entry/2014/08/16/231842)
    - OK が出るまで変更->プッシュ->コードレビューを繰り返します。

1. マージ
    - コードレビューによって問題がなくなったら master にマージします。（通常これは管理者のしごとです）

1. 結果を確認
    - リモートのmasterブランチが変更されたことを確認します。
    - fectchコマンドは「origin/master」ブランチを最新にします。
    - mergeコマンドはorigin/masterの変更をmasterブランチに反映します

    ``` bash
    $ git branch -a
    $ git checkout master
    $ git fetch
    $ git merge origin/master
    ```

    - さて実はfectch～mergeまで一発でできるコマンドがあります。pullです。
    - ですがmergeもやってくれやがるので競合が発生する場合があります。fectchして競合が発生しないことを確認してからのpullが無難です

### 参考・引用

- https://github.com/tbpgr/github_flow_for_ja
- http://macotox.hateblo.jp/entry/2014/08/16/231842
